name: Enviar archivo a Telegram

on:
  workflow_dispatch:
    inputs:
      download_url:
        description: 'Enlace directo al archivo a enviar (http/https)'
        required: true
        type: string
      filename:
        description: 'Nombre deseado del archivo local (ej. archivo.zip)'
        required: true
        type: string

jobs:
  enviar_a_telegram:
    runs-on: ubuntu-latest

    services:
      telegram-bot-api:
        image: ghcr.io/lukaszraczylo/tdlib-telegram-bot-api-docker/telegram-api-server:latest
        ports:
          - 8081:8081
        env:
          TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
          TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        options: >-
          --health-cmd "curl --fail http://localhost:8081 || exit 1"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 3

    steps:
    - name: ðŸ“¥ Descargar archivo con aria2
      run: |
        sudo apt-get update && sudo apt-get install -y aria2
        aria2c "${{ inputs.download_url }}" \
          -o "${{ inputs.filename }}" \
          --max-connection-per-server=4 \
          --split=4 \
          --enable-rpc=false
        ls -lh "${{ inputs.filename }}"

    - name: ðŸ“¤ Enviar archivo a Telegram
      env:
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        curl -s -X POST "http://localhost:8081/bot${TELEGRAM_BOT_TOKEN}/sendDocument" \
          -F chat_id=${TELEGRAM_CHAT_ID} \
          -F caption="ðŸ“¦ Archivo completo: '${{ inputs.filename }}'" \
          -F document=@"${{ inputs.filename }}"
