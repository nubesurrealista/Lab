name: FFmpeg Android armv7 Build

on:
  workflow_dispatch:

jobs:
  build-armv7:
    runs-on: ubuntu-24.04

    steps:
      - name: Clone ffmpeg-android-maker
        run: |
          git clone https://github.com/Javernaut/ffmpeg-android-maker.git

      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y meson nasm ninja-build curl unzip tree

      - name: Set Android environment variables
        run: |
          echo "ANDROID_SDK_HOME=$ANDROID_HOME" >> $GITHUB_ENV
          echo "ANDROID_NDK_HOME=$ANDROID_NDK_LATEST_HOME" >> $GITHUB_ENV

      - name: Run ffmpeg-android-maker for armv7
        working-directory: ./ffmpeg-android-maker
        run: |
          chmod +x ffmpeg-android-maker.sh
          ./ffmpeg-android-maker.sh -all-free -all-gpl -android=24 -abis=armeabi-v7a

      - name: Debug: list all build directories and files
        run: |
          echo "📂 Full directory tree under ffmpeg-android-maker/build:"
          tree ffmpeg-android-maker/build || echo "⚠️ No build directory found"
          echo "📁 Listing all files with full paths:"
          find ffmpeg-android-maker/build -type f -exec ls -lh {} \;

      - name: Upload ffmpeg binary
        uses: actions/upload-artifact@v4
        with:
          name: ffmpeg-armv7
          path: |
            ffmpeg-android-maker/build/armeabi-v7a/output/bin/ffmpeg
