---
name: Build Hyfetch for Android ARMv7
on:
  workflow_dispatch: null
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
        with:
          targets: armv7-linux-androideabi
      - name: Install cargo-ndk
        run: cargo install cargo-ndk
      - name: Download and set up Android NDK
        uses: nttld/setup-ndk@v1
        with:
          ndk-version: r26d
          add-to-path: true
          local-cache: true
      - name: Clone Hyfetch repository
        run: |
          git clone https://github.com/hykilpikonna/hyfetch.git
          cd hyfetch
          cargo fetch --locked  # Pre-descarga dependencias
      - name: Build Hyfetch for Android ARMv7
        working-directory: hyfetch
        env:
          RUSTFLAGS: -C target_feature=+crt-static
        run: |
          # Usa cargo-ndk para manejar el NDK y cross-compile
          cargo ndk -t armeabi-v7a build --release --all-features
          # Verifica el binario (opcional, para logs)
          file target/armv7-linux-androideabi/release/hyfetch
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: hyfetch-android-armv7
          path: hyfetch/target/armv7-linux-androideabi/release/hyfetch
          retention-days: 5
