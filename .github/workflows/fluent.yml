name: Build and Package Fluent Flame Native Linux Binary

on:
  workflow_dispatch:

jobs:
  build-native:
    runs-on: ubuntu-latest
    container: debian:12
    steps:
      - name: Install system dependencies
        run: |
          apt-get update -y
          apt-get install -y \
            curl gnupg git build-essential \
            libx11-dev libxkbfile-dev libsecret-1-dev \
            libkrb5-dev libnss3-dev libasound2-dev \
            libcups2-dev libcap-dev libxtst-dev \
            libxss-dev \
            libgtk-3-dev libayatana-appindicator3-dev \
            librsvg2-dev libnotify-dev \
            python3 unzip zip

      - name: Install Node.js 20
        run: |
          curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
          apt-get install -y nodejs

      - name: Clone Fluent Flame repository
        run: git clone --depth 1 https://github.com/FluentFlame/fluentflame-reader.git fluent-flame

      - name: Install npm dependencies
        working-directory: fluent-flame
        run: npm install

      - name: Build application
        working-directory: fluent-flame
        run: npm run build

      - name: Build Native Linux Binary (tar.xz)
        working-directory: fluent-flame
        run: npx electron-builder --linux tar.xz --publish never

      - name: List generated files
        run: find $GITHUB_WORKSPACE -name '*.tar.xz' -print

      - name: Upload Native Binary
        uses: actions/upload-artifact@v4
        with:
          name: FluentFlame-Native-Linux
          path: |
            **/*.tar.xz
